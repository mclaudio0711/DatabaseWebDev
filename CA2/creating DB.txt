MC - 2021.11.22

CREATE TABLE departments (
    dept_id     INTEGER  NOT NULL,
    dept_name   TEXT     NOT NULL,
    PRIMARY KEY (dept_id),
    CONSTRAINT dept_name_unique UNIQUE (dept_name)
)

CREATE TABLE employees (
    emp_id      INTEGER  NOT NULL,
    birth_date  DATE     NOT NULL,
    first_name  TEXT     NOT NULL,
    last_name   TEXT     NOT NULL,
    gender      CHAR     NOT NULL check(gender="M" or gender="F"),    
    hire_date   DATE     NOT NULL,
    PRIMARY KEY (emp_id)
)
CREATE TABLE salaries (
    emp_id      INTEGER         NOT NULL,
    salary      NUMBER          NOT NULL,
    from_date   DATE            NOT NULL,
    to_date     DATE            NOT NULL,
    FOREIGN KEY (emp_id) REFERENCES employees (emp_id) ON DELETE CASCADE,
    PRIMARY KEY (emp_id, from_date)
)
CREATE TABLE titles (
    emp_id      INTEGER  NOT NULL,
    title       TEXT     NOT NULL,
    from_date   DATE     NOT NULL,
    to_date     DATE,
    FOREIGN KEY (emp_id) REFERENCES employees (emp_id) ON DELETE CASCADE,
    PRIMARY KEY (emp_id,title, from_date)
)

CREATE TABLE dept_manager (
   dept_id      INTEGER  NOT NULL,
   emp_id       INTEGER  NOT NULL,
   from_date    DATE     NOT NULL,
   to_date      DATE     NOT NULL,
   FOREIGN KEY (emp_id)  REFERENCES employees (emp_id)    ON DELETE CASCADE,
   FOREIGN KEY (dept_id) REFERENCES departments (dept_id) ON DELETE CASCADE,
   PRIMARY KEY (emp_id, dept_id)
)

CREATE TABLE dept_emp (
    emp_id      INTEGER  NOT NULL,
    dept_id     INTEGER  NOT NULL,
    from_date   DATE     NOT NULL,
    to_date     DATE     NOT NULL,
    FOREIGN KEY (emp_id)  REFERENCES employees   (emp_id)  ON DELETE CASCADE,
    FOREIGN KEY (dept_id) REFERENCES departments (dept_id) ON DELETE CASCADE,
    PRIMARY KEY (emp_id, dept_id)
)


INSERT INTO emp_training (first_name,last_name,t_module) VALUES 
( 'Paul', 32, 'California', 20000.00 );


SELECT dept_emp.emp_id, employees.first_name, dept_emp.dept_id, dept_emp.from_date,dept_emp.to_date
  FROM dept_emp
  INNER JOIN employees ON employees.emp_id = dept_emp.emp_id;
 
SELECT dept_emp.emp_id, employees.first_name, dept_emp.dept_id, dept_emp.from_date,dept_emp.to_date
 FROM dept_emp
 JOIN employees;
 
SELECT dept_emp.emp_id, employees.first_name, dept_emp.dept_id, departments.dept_name, dept_emp.from_date,dept_emp.to_date
FROM dept_emp
  INNER JOIN employees ON employees.emp_id = dept_emp.emp_id
  INNER JOIN departments ON departments.dept_id = dept_emp.dept_id;

SELECT emp_id, COUNT(*) as "Total number of the titles"
FROM salaries
GROUP BY emp_id
HAVING COUNT(salary) BETWEEN 90000 and 90040;

SELECT emp_id, salary, from_date, to_date
FROM salaries
	WHERE salary BETWEEN 90000 and 90040;

SELECT salaries.emp_id, employees.last_name, employees.first_name, salaries.salary, salaries.to_date
FROM salaries
	INNER JOIN employees ON employees.emp_id = salaries.emp_id
WHERE salary BETWEEN 90000 AND 90040
	AND to_date = '9999-01-01'
GROUP BY last_name, first_name
ORDER BY last_name DESC, first_name DESC;


SELECT salaries.emp_id, employees.last_name, employees.first_name, salaries.salary, salaries.to_date
FROM salaries
	INNER JOIN employees ON employees.emp_id = salaries.emp_id
WHERE salary > 90000
	and to_date = '9999-01-01'
GROUP BY last_name, first_name
ORDER BY last_name DESC, first_name DESC;


Criando Banco de Dados 
CREATE SCHEMA `dbmercadinho` DEFAULT CHARACTER SET latin1 ;